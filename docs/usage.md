# Сценарий использования Telegram Dialog Quality Bot

## 1. Назначение системы

Telegram Dialog Quality Bot предназначен для анализа качества коммуникации в Telegram-чатах.  
Бот оценивает тональность сообщений, выявляет проблемы коммуникации и рассчитывает метрику скорости ответа.

---

## 2. Подготовка к работе

1. Бот добавляется в Telegram-чат.
2. Бот должен иметь доступ к чтению сообщений.
3. У администратора должны быть права на использование команд анализа.

---

## 3. Основные команды

### /analyze YYYY-MM-DD YYYY-MM-DD

Запускает анализ сообщений за указанный период.

Пример: /analyze 2026-02-01 2026-02-25

Что происходит:
- сообщения за период извлекаются из базы данных;
- текст отправляется в Yandex Cloud GPT;
- результат (тональность и тип проблемы) сохраняется в таблицу `analysis_results`;
- бот возвращает статистику:
  - сколько сообщений проанализировано;
  - сколько выявлено проблем.

---

### /issues YYYY-MM-DD YYYY-MM-DD

Выводит список проблемных сообщений за период.

Пример: /issues 2026-02-01 2026-02-25


Бот выводит:
- дату сообщения;
- пользователя;
- тип проблемы;
- фрагмент текста.

---

### /report YYYY-MM-DD YYYY-MM-DD

Формирует агрегированный отчёт за период.

Пример: /report 2026-02-01 2026-02-25


Отчёт включает:

- количество проанализированных сообщений;
- количество проблемных сообщений;
- распределение типов проблем;
- метрику скорости ответа.

---

## 4. Метрика скорости ответа

Скорость ответа рассчитывается как:

> разница во времени между сообщением пользователя и первым последующим сообщением в чате от другого пользователя.

Служебные команды (начинающиеся с "/") исключаются из расчёта.

В отчёте выводится:
- количество найденных ответов;
- среднее время ответа (в секундах);
- медианное время ответа.

Если в выбранный период нет сообщений от разных пользователей подряд,
метрика не рассчитывается и выводится "нет данных".

---

## 5. Хранение результатов анализа

Результаты анализа сохраняются в таблице `analysis_results`:

- message_id
- sentiment (тональность)
- detected_problem (тип проблемы)
- analysis_date

Это позволяет:
- строить отчёты за любой период;
- анализировать динамику качества коммуникации;
- выявлять повторяющиеся проблемы.

---

## 6. Пример рабочего сценария

1. Пользователь пишет сообщение в чат.
2. Второй пользователь отвечает.
3. Администратор запускает: /analyze 2026-02-25 2026-02-25
4. Затем: /report 2026-02-25 2026-02-25

Бот показывает:
- количество проблем;
- типы проблем;
- скорость ответа между участниками.

---

## 7. Ограничения

- Анализ проводится только по сохранённым в базе сообщениям.
- Метрика скорости ответа работает только при наличии сообщений от разных пользователей.
- Для работы анализа требуется корректный IAM-токен Yandex Cloud.